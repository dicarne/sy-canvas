import{c as S,r as g,o as P,a as x,d as O,b as M,l as K,u as Q,e as A,f as I,g as B,h as n,i as r,w as f,N as m,j as w,t as G,k as F,v as N,m as R,n as Z,p as $,q as L,s as j,x as ee,y as te,z as oe,A as ne,F as le,B as ae,C as ue,D as se}from"./vendor.ad265602.js";const ie=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function h(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(a){if(a.ep)return;a.ep=!0;const i=h(a);fetch(a.href,i)}};ie();function re(k){var l=atob(k),h=decodeURI(l);return h}const ce=()=>{const k=S(),l=g("");P(async()=>{var c;l.value=((c=await x.getBlockAttr(k,"custom-config"))==null?void 0:c.value)||"";const s=window.localStorage.getItem("sy-canvas-config");s!=null&&s!=l.value&&(l.value=s,await x.setBlockAttrs({id:k,attrs:{"custom-config":l.value}})),s==null&&l.value!=""&&window.localStorage.setItem("sy-canvas-config",l.value),i()});const h=s=>{l.value=s},t=()=>{window.localStorage.setItem("sy-canvas-config",l.value),x.setBlockAttrs({id:k,attrs:{"custom-config":l.value}}),i()},a=g(null),i=async()=>{try{let s=l.value;l.value.startsWith("siyuan://blocks/")&&(s=s.substring(16));const c=await x.sqlQuery(`select * from blocks where id="${s}"`);c.data.length>0&&(a.value=JSON.parse(c.data[0].content))}catch{console.error("sy-canvas config parse error")}};return{my_config_url:l,set_config_url:h,comfirm_change:t,config:a}},de=["width","height"],ve={key:0,style:{position:"fixed",bottom:"0px",width:"100vw",backgroundColor:"#fff",paddingTop:"10px",paddingLeft:"5px",paddingBottom:"10px","box-shadow":"0px 0px 10px #ddd"}},fe=w("\u8BBE\u7F6E"),he=w("\u64A4\u9500"),pe=B("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",color:"#666666",viewBox:"0 0 512 512"},[B("path",{d:"M336 208v-95a80 80 0 0 0-160 0v95",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),B("rect",{x:"96",y:"208",width:"320",height:"272",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"})],-1),ge=w(" \u80CC\u666F\u989C\u8272 "),we=w("\u914D\u7F6E\u4EE3\u7801 "),ke=w("\u5E2E\u52A9"),me=w("\u6E05\u7A7A"),_e=w("\u53D6\u6D88"),ye=w("\u786E\u8BA4"),xe=O({setup(k){const l=g(null),h=ce(),t=g(),a=M({w:1e3,h:1e3}),i=g(!1),s=g("DRAW"),c=g([]),_=g({width:2,color:"#000000",points:[]}),d=M({color:"#000",width:3,background:"#fff"}),v=g(!0),b=K.exports.throttle(()=>{!t.value||(t.value.fillStyle=d.background,t.value.fillRect(0,0,a.w,a.h),c.value.forEach(o=>{if(!(!t.value||o.points.length<=1)){t.value.beginPath(),t.value.strokeStyle=o.color,t.value.lineJoin="round",t.value.lineWidth=o.width,t.value.moveTo(o.points[0].x,o.points[0].y);for(let e=1;e<o.points.length;e++){const u=o.points[e];t.value.lineTo(u.x,u.y)}t.value.stroke(),t.value.closePath()}}))},500);P(async()=>{const o=S();if(l.value){if(t.value=l.value.getContext("2d"),!t.value)return;t.value.imageSmoothingEnabled=!0,a.w=l.value.clientWidth,a.h=l.value.clientHeight;const e=await x.getBlockAttr(o,"custom-data");if(e){const u=JSON.parse(re(e.value));c.value=u.stokes,d.background=u.config.background,d.color=u.config.color,d.width=u.config.width}else v.value=!1;setTimeout(b,1)}window.onresize=()=>{a.w=l.value.clientWidth,a.h=l.value.clientHeight,t.value=l.value.getContext("2d"),setTimeout(b,1)}});const J=()=>l.value?{w:l.value.clientWidth,h:l.value.clientHeight}:null,D=o=>{const e=J();if(o instanceof TouchEvent){const u=o.changedTouches[0];return{x:Math.trunc(u.clientX/e.w*a.w),y:Math.trunc(u.clientY/e.h*a.h)}}else if(o instanceof MouseEvent)return{x:Math.trunc(o.clientX/e.w*a.w),y:Math.trunc(o.clientY/e.h*a.h)};throw new Error("unknown device!")},T=o=>{let e=o;if(e.button&&e.button==2?s.value="EARSE":s.value="DRAW",v.value)return;const u=D(o);i.value=!0,!!t.value&&(t.value.beginPath(),_.value={width:s.value=="DRAW"?d.width:d.width+8,color:s.value=="DRAW"?d.color:d.background,points:[u]},t.value.moveTo(u.x,u.y),t.value.strokeStyle=_.value.color,t.value.lineJoin="round",t.value.lineWidth=_.value.width)},U=o=>{!t.value||(_.value.points.push(o),t.value.lineTo(o.x,o.y),t.value.stroke())},W=o=>{if(i.value&&!v.value){const e=D(o);o.preventDefault(),o.stopPropagation(),U(e)}},E=()=>{h.comfirm_change(),x.setBlockAttrs({id:S(),attrs:{"custom-data":btoa(encodeURI(JSON.stringify({version:1,stokes:ae(c.value),config:d})))}})},C=o=>{if(i.value&&!v.value){if(i.value=!1,!t.value)return;const e=D(o);t.value.lineTo(e.x,e.y),t.value.stroke(),t.value.closePath(),c.value.push(_.value),_.value=null,E()}},q=o=>{d.color=o},z=g(["#FFFFFF","#000","#18A058","#2080F0","#F0A020","rgba(208, 48, 80, 1)"]),p=M({show:!1,background:"#fff",changeColor:o=>{c.value.forEach(e=>{e.color===p.background&&(e.color=o)}),p.background=o},ok:()=>{d.background=p.background,p.show=!1,E(),setTimeout(b,1)}}),H=()=>{c.value.splice(c.value.length-1,1),b(),E()},V=Q(),X=()=>{V.warning({title:"\u8B66\u544A",content:"\u662F\u5426\u6E05\u7A7A\u6240\u6709\u5185\u5BB9\uFF1F\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\uFF01",positiveText:"\u786E\u5B9A",negativeText:"\u4E0D\u786E\u5B9A",onPositiveClick:()=>{c.value=[],d.background="#fff",b(),E(),p.show=!1},onNegativeClick:()=>{}})},Y=()=>{window.open("https://github.com/dicarne/sy-canvas#\u8BBE\u7F6E")};return(o,e)=>(A(),I(le,null,[B("canvas",{style:{width:"100vw",height:"100vh"},width:n(a).w,height:n(a).h,ref:(u,y)=>{y.canvas=u,l.value=u},ontouchstart:T,ontouchmove:W,ontouchend:C,ontouchcancel:C,onpointerdown:T,onpointermove:W,onpointerleave:C,onpointerup:C},null,8,de),v.value?L("",!0):(A(),I("div",ve,[r(n($),{align:"center",justify:"center"},{default:f(()=>{var u;return[r(n(m),{onClick:e[0]||(e[0]=y=>v.value=!v.value)},{default:f(()=>[w(G(v.value?"\u89E3\u9501":"\u9501\u5B9A"),1)]),_:1}),F(r(n(m),{onClick:e[1]||(e[1]=y=>n(p).show=!0)},{default:f(()=>[fe]),_:1},512),[[N,!v.value]]),F(r(n(m),{onClick:e[2]||(e[2]=y=>H()),disabled:c.value.length===0},{default:f(()=>[he]),_:1},8,["disabled"]),[[N,!v.value]]),F(r(n(R),{"on-update:value":q,style:{width:"40vw",minWidth:"300px",maxWidth:"500px",display:"block"},"show-alpha":!1,swatches:((u=n(h).config.value)==null?void 0:u.colors)?n(h).config.value.colors:z.value},null,8,["swatches"]),[[N,!v.value]]),F(r(n(Z),{value:n(d).width,"onUpdate:value":e[3]||(e[3]=y=>n(d).width=y),step:1,min:1,max:20,style:{width:"40vw",minWidth:"300px",maxWidth:"500px","--rail-height":"10px"}},null,8,["value"]),[[N,!v.value]])]}),_:1})])),v.value?(A(),j(n(m),{key:1,circle:"",style:{position:"absolute",width:"32px",height:"32px",right:"10px",bottom:"10px"},onClick:e[4]||(e[4]=u=>v.value=!v.value)},{icon:f(()=>[r(n(ee),null,{default:f(()=>[pe]),_:1})]),_:1})):L("",!0),r(n(ne),{show:n(p).show,"onUpdate:show":e[7]||(e[7]=u=>n(p).show=u),style:{position:"fixed",top:"10px"}},{default:f(()=>[r(n(te),{style:{width:"100vw"},title:"\u8BBE\u7F6E",bordered:!1,size:"huge"},{footer:f(()=>[r(n($),null,{default:f(()=>[r(n(m),{onClick:Y},{default:f(()=>[ke]),_:1}),r(n(m),{onClick:X},{default:f(()=>[me]),_:1}),r(n(m),{onClick:e[5]||(e[5]=u=>n(p).show=!1)},{default:f(()=>[_e]),_:1}),r(n(m),{onClick:e[6]||(e[6]=u=>n(p).ok())},{default:f(()=>[ye]),_:1})]),_:1})]),default:f(()=>[ge,r(n(R),{"show-alpha":!1,"on-update:value":n(p).changeColor,"default-value":n(d).background},null,8,["on-update:value","default-value"]),we,r(n(oe),{placeholder:"\u4EE3\u7801\u5757\u8D85\u94FE\u63A5\u6216block id","on-update:value":n(h).set_config_url,value:n(h).my_config_url.value},null,8,["on-update:value","value"])]),_:1})]),_:1},8,["show"])],64))}});const be=O({setup(k){return(l,h)=>(A(),j(n(ue),null,{default:f(()=>[r(xe)]),_:1}))}});se(be).mount("#app");
//# sourceMappingURL=index.c4f043a1.js.map
