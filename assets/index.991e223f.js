import{d as N,r as p,a as F,l as R,o as j,c as T,b as M,u as H,e as S,f as V,g as D,h as n,i as r,w as d,N as w,j as g,t as q,k as y,v as b,m as P,n as X,p as E,q as Y,s as K,F as G,x as Q,y as Z,z as ee,A as te}from"./vendor.82cfd83f.js";const oe=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const a of u)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function t(u){const a={};return u.integrity&&(a.integrity=u.integrity),u.referrerpolicy&&(a.referrerPolicy=u.referrerpolicy),u.crossorigin==="use-credentials"?a.credentials="include":u.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(u){if(u.ep)return;u.ep=!0;const a=t(u);fetch(u.href,a)}};oe();function ne(k){var s=atob(k),t=decodeURI(s);return t}const le=["width","height"],ue={style:{position:"fixed",bottom:"0px",width:"100vw",backgroundColor:"#fff",paddingTop:"10px",paddingLeft:"5px",paddingBottom:"10px","box-shadow":"0px 0px 10px #ddd"}},ae=g("\u8BBE\u7F6E"),se=g("\u64A4\u9500"),ie=g(" \u80CC\u666F\u989C\u8272 "),re=g("\u6E05\u7A7A"),ce=g("\u53D6\u6D88"),de=g("\u786E\u8BA4"),ve=N({setup(k){const s=p(null),t=p(),i=F({w:1e3,h:1e3}),u=p(!1),a=p([]),f=p({width:2,color:"#000000",points:[]}),c=F({color:"#000",width:3,background:"#fff"}),v=p(!0),m=R.exports.throttle(()=>{!t.value||(t.value.fillStyle=c.background,t.value.fillRect(0,0,i.w,i.h),a.value.forEach(o=>{if(!(!t.value||o.points.length<=1)){t.value.beginPath(),t.value.strokeStyle=o.color,t.value.lineJoin="round",t.value.lineWidth=o.width,t.value.moveTo(o.points[0].x,o.points[0].y);for(let e=1;e<o.points.length;e++){const l=o.points[e];t.value.lineTo(l.x,l.y)}t.value.stroke(),t.value.closePath()}}))},500);j(async()=>{const o=T();if(s.value){if(t.value=s.value.getContext("2d"),!t.value)return;t.value.imageSmoothingEnabled=!0,i.w=s.value.clientWidth,i.h=s.value.clientHeight;const e=await M.getBlockAttr(o,"custom-data");if(e){const l=JSON.parse(ne(e.value));a.value=l.stokes,c.background=l.config.background,c.color=l.config.color,c.width=l.config.width}else v.value=!1;setTimeout(m,1)}window.onresize=()=>{i.w=s.value.clientWidth,i.h=s.value.clientHeight,t.value=s.value.getContext("2d"),setTimeout(m,1)}});const O=()=>s.value?{w:s.value.clientWidth,h:s.value.clientHeight}:null,C=o=>{const e=O();if(o instanceof TouchEvent){const l=o.changedTouches[0];return{x:Math.trunc(l.clientX/e.w*i.w),y:Math.trunc(l.clientY/e.h*i.h)}}else if(o instanceof MouseEvent)return{x:Math.trunc(o.clientX/e.w*i.w),y:Math.trunc(o.clientY/e.h*i.h)};throw new Error("unknown device!")},A=o=>{if(v.value)return;const e=C(o);u.value=!0,!!t.value&&(t.value.beginPath(),f.value={width:c.width,color:c.color,points:[e]},t.value.moveTo(e.x,e.y),t.value.strokeStyle=f.value.color,t.value.lineJoin="round",t.value.lineWidth=f.value.width)},W=o=>{!t.value||(f.value.points.push(o),t.value.lineTo(o.x,o.y),t.value.stroke())},B=o=>{if(u.value&&!v.value){const e=C(o);W(e)}},x=()=>{M.setBlockAttrs({id:T(),attrs:{"custom-data":btoa(encodeURI(JSON.stringify({version:1,stokes:Q(a.value),config:c})))}})},_=o=>{if(u.value&&!v.value){if(u.value=!1,!t.value)return;const e=C(o);t.value.lineTo(e.x,e.y),t.value.stroke(),t.value.closePath(),a.value.push(f.value),f.value=null,x()}},L=o=>{c.color=o},$=p(["#FFFFFF","#000","#18A058","#2080F0","#F0A020","rgba(208, 48, 80, 1)"]),h=F({show:!1,background:"#fff",changeColor:o=>{h.background=o},ok:()=>{c.background=h.background,h.show=!1,x(),setTimeout(m,1)}}),U=()=>{a.value.splice(a.value.length-1,1),m(),x()},z=H(),I=()=>{z.warning({title:"\u8B66\u544A",content:"\u662F\u5426\u6E05\u7A7A\u6240\u6709\u5185\u5BB9\uFF1F\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\uFF01",positiveText:"\u786E\u5B9A",negativeText:"\u4E0D\u786E\u5B9A",onPositiveClick:()=>{a.value=[],c.background="#fff",m(),x(),h.show=!1},onNegativeClick:()=>{}})};return(o,e)=>(S(),V(G,null,[D("canvas",{style:{width:"100vw",height:"100vh"},width:n(i).w,height:n(i).h,ref:(l,J)=>{J.canvas=l,s.value=l},ontouchstart:A,ontouchmove:B,ontouchend:_,ontouchcancel:_,onmousedown:A,onmousemove:B,onmouseleave:_,onmouseup:_},null,8,le),D("div",ue,[r(n(E),{align:"center",justify:"center"},{default:d(()=>[r(n(w),{onClick:e[0]||(e[0]=l=>v.value=!v.value)},{default:d(()=>[g(q(v.value?"\u89E3\u9501":"\u9501\u5B9A"),1)]),_:1}),y(r(n(w),{onClick:e[1]||(e[1]=l=>n(h).show=!0)},{default:d(()=>[ae]),_:1},512),[[b,!v.value]]),y(r(n(w),{onClick:e[2]||(e[2]=l=>U()),disabled:a.value.length===0},{default:d(()=>[se]),_:1},8,["disabled"]),[[b,!v.value]]),y(r(n(P),{"on-update:value":L,style:{width:"40vw",minWidth:"300px",maxWidth:"500px",display:"block"},"show-alpha":!1,swatches:$.value},null,8,["swatches"]),[[b,!v.value]]),y(r(n(X),{value:n(c).width,"onUpdate:value":e[3]||(e[3]=l=>n(c).width=l),step:1,min:1,max:20,style:{width:"40vw",minWidth:"300px",maxWidth:"500px","--rail-height":"10px"}},null,8,["value"]),[[b,!v.value]])]),_:1})]),r(n(K),{show:n(h).show,"onUpdate:show":e[6]||(e[6]=l=>n(h).show=l),style:{position:"fixed",top:"10px"}},{default:d(()=>[r(n(Y),{style:{width:"100vw"},title:"\u8BBE\u7F6E",bordered:!1,size:"huge"},{footer:d(()=>[r(n(E),null,{default:d(()=>[r(n(w),{onClick:e[4]||(e[4]=l=>n(h).show=!1)},{default:d(()=>[ce]),_:1}),r(n(w),{onClick:e[5]||(e[5]=l=>n(h).ok())},{default:d(()=>[de]),_:1})]),_:1})]),default:d(()=>[ie,r(n(P),{"show-alpha":!1,"on-update:value":n(h).changeColor,"default-value":n(c).background},null,8,["on-update:value","default-value"]),r(n(E),null,{default:d(()=>[r(n(w),{onClick:I},{default:d(()=>[re]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64))}});const fe=N({setup(k){return(s,t)=>(S(),Z(n(ee),null,{default:d(()=>[r(ve)]),_:1}))}});te(fe).mount("#app");
//# sourceMappingURL=index.991e223f.js.map
