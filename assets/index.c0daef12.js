import{c as M,r as h,o as O,a as A,d as $,b as T,l as te,u as oe,e as N,f as I,g as S,h as o,i as r,w as d,N as m,j as w,t as L,k as C,v as B,m as j,n as ne,p as J,q as U,s as q,x as le,y as ae,z as ue,A as se,F as ie,B as re,C as ce,D as de}from"./vendor.ad265602.js";const ve=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function f(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=f(a);fetch(a.href,i)}};ve();function fe(_){var l=atob(_),f=decodeURI(l);return f}const he=()=>{const _=M(),l=h("");O(async()=>{var p;l.value=((p=await A.getBlockAttr(_,"custom-config"))==null?void 0:p.value)||"";const s=window.localStorage.getItem("sy-canvas-config");s!=null&&s!=l.value&&(l.value=s,await A.setBlockAttrs({id:_,attrs:{"custom-config":l.value}})),s==null&&l.value!=""&&window.localStorage.setItem("sy-canvas-config",l.value),i()});const f=s=>{l.value=s},n=()=>{window.localStorage.setItem("sy-canvas-config",l.value),A.setBlockAttrs({id:_,attrs:{"custom-config":l.value}}),i()},a=h(null),i=async()=>{try{let s=l.value;l.value.startsWith("siyuan://blocks/")&&(s=s.substring(16));const p=await A.sqlQuery(`select * from blocks where id="${s}"`);p.data.length>0&&(a.value=JSON.parse(p.data[0].content))}catch{console.error("sy-canvas config parse error")}};return{my_config_url:l,set_config_url:f,comfirm_change:n,config:a}},pe=["width","height"],ge={key:0,style:{position:"fixed",bottom:"0px",width:"100vw",backgroundColor:"#fff",paddingTop:"10px",paddingLeft:"5px",paddingBottom:"10px","box-shadow":"0px 0px 10px #ddd"}},we=w("\u8BBE\u7F6E"),ke=w("\u64A4\u9500"),me=w("\u6062\u590D"),_e=S("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",color:"#666666",viewBox:"0 0 512 512"},[S("path",{d:"M336 208v-95a80 80 0 0 0-160 0v95",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),S("rect",{x:"96",y:"208",width:"320",height:"272",rx:"48",ry:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"})],-1),ye=w(" \u80CC\u666F\u989C\u8272 "),xe=w("\u914D\u7F6E\u4EE3\u7801 "),be=w("\u5E2E\u52A9"),Ee=w("\u6E05\u7A7A"),Ae=w("\u53D6\u6D88"),Ce=w("\u786E\u8BA4"),Be=$({setup(_){const l=h(null),f=he(),n=h(),a=T({w:1e3,h:1e3}),i=h(!1),s=h("DRAW"),p=h("DRAW"),k=h([]),x=h({width:2,color:"#000000",points:[]}),v=T({color:"#000",width:3,background:"#fff"}),c=h(!0),b=te.exports.throttle(()=>{!n.value||(n.value.fillStyle=v.background,n.value.fillRect(0,0,a.w,a.h),k.value.forEach(t=>{if(!(!n.value||t.points.length<=1)){n.value.beginPath(),n.value.strokeStyle=t.color,n.value.lineJoin="round",n.value.lineWidth=t.width,n.value.moveTo(t.points[0].x,t.points[0].y);for(let e=1;e<t.points.length;e++){const u=t.points[e];n.value.lineTo(u.x,u.y)}n.value.stroke(),n.value.closePath()}}))},500);O(async()=>{const t=M();if(l.value){if(n.value=l.value.getContext("2d"),!n.value)return;n.value.imageSmoothingEnabled=!0,a.w=l.value.clientWidth,a.h=l.value.clientHeight;const e=await A.getBlockAttr(t,"custom-data");if(e){const u=JSON.parse(fe(e.value));k.value=u.stokes,v.background=u.config.background,v.color=u.config.color,v.width=u.config.width}else c.value=!1;setTimeout(b,1)}window.onresize=()=>{a.w=l.value.clientWidth,a.h=l.value.clientHeight,n.value=l.value.getContext("2d"),setTimeout(b,1)}});const z=()=>l.value?{w:l.value.clientWidth,h:l.value.clientHeight}:null,W=t=>{const e=z();if(t instanceof TouchEvent){const u=t.changedTouches[0];return{x:Math.trunc(u.clientX/e.w*a.w),y:Math.trunc(u.clientY/e.h*a.h)}}else if(t instanceof MouseEvent)return{x:Math.trunc(t.clientX/e.w*a.w),y:Math.trunc(t.clientY/e.h*a.h)};throw new Error("unknown device!")},R=t=>{let e=t;if(e.button&&e.button==2?s.value="EARSE":s.value=p.value,c.value)return;const u=W(t);i.value=!0,!!n.value&&(n.value.beginPath(),x.value={width:s.value=="DRAW"?v.width:v.width+8,color:s.value=="DRAW"?v.color:v.background,points:[u]},n.value.moveTo(u.x,u.y),n.value.strokeStyle=x.value.color,n.value.lineJoin="round",n.value.lineWidth=x.value.width)},H=t=>{!n.value||(x.value.points.push(t),n.value.lineTo(t.x,t.y),n.value.stroke())},P=t=>{if(i.value&&!c.value){const e=W(t);t.preventDefault(),t.stopPropagation(),H(e)}},F=()=>{f.comfirm_change(),A.setBlockAttrs({id:M(),attrs:{"custom-data":btoa(encodeURI(JSON.stringify({version:1,stokes:re(k.value),config:v})))}})},D=t=>{if(i.value&&!c.value){if(i.value=!1,!n.value)return;const e=W(t);n.value.lineTo(e.x,e.y),n.value.stroke(),n.value.closePath(),k.value.push(x.value),x.value=null,E.value=[],F()}},V=t=>{v.color=t},X=h(["#FFFFFF","#000","#18A058","#2080F0","#F0A020","rgba(208, 48, 80, 1)"]),g=T({show:!1,background:"#fff",changeColor:t=>{k.value.forEach(e=>{e.color===g.background&&(e.color=t)}),g.background=t},ok:()=>{v.background=g.background,g.show=!1,F(),setTimeout(b,1)}}),E=h([]),Y=()=>{let t=k.value.splice(k.value.length-1,1);E.value.push(t[0]),b(),F()},K=oe(),Q=()=>{K.warning({title:"\u8B66\u544A",content:"\u662F\u5426\u6E05\u7A7A\u6240\u6709\u5185\u5BB9\uFF1F\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\uFF01",positiveText:"\u786E\u5B9A",negativeText:"\u4E0D\u786E\u5B9A",onPositiveClick:()=>{k.value=[],v.background="#fff",b(),F(),g.show=!1},onNegativeClick:()=>{}})},G=()=>{window.open("https://github.com/dicarne/sy-canvas#\u8BBE\u7F6E")},Z=()=>{if(E.value.length>0){let t=E.value.splice(E.value.length-1,1);k.value.push(t[0]),b(),F()}},ee=()=>{p.value==="DRAW"?p.value="EARSE":p.value="DRAW"};return(t,e)=>(N(),I(ie,null,[S("canvas",{style:{width:"100vw",height:"100vh"},width:o(a).w,height:o(a).h,ref:(u,y)=>{y.canvas=u,l.value=u},ontouchstart:R,ontouchmove:P,ontouchend:D,ontouchcancel:D,onpointerdown:R,onpointermove:P,onpointerleave:D,onpointerup:D},null,8,pe),c.value?U("",!0):(N(),I("div",ge,[r(o(J),{align:"center",justify:"center"},{default:d(()=>{var u;return[r(o(m),{onClick:e[0]||(e[0]=y=>c.value=!c.value)},{default:d(()=>[w(L(c.value?"\u89E3\u9501":"\u9501\u5B9A"),1)]),_:1}),C(r(o(m),{onClick:e[1]||(e[1]=y=>o(g).show=!0)},{default:d(()=>[we]),_:1},512),[[B,!c.value]]),C(r(o(m),{onClick:e[2]||(e[2]=y=>Y()),disabled:k.value.length===0},{default:d(()=>[ke]),_:1},8,["disabled"]),[[B,!c.value]]),C(r(o(m),{onClick:e[3]||(e[3]=y=>Z()),disabled:E.value.length===0},{default:d(()=>[me]),_:1},8,["disabled"]),[[B,!c.value]]),C(r(o(m),{onClick:e[4]||(e[4]=y=>ee())},{default:d(()=>[w(L(p.value=="DRAW"?"\u6A61\u76AE":"\u753B\u7B14"),1)]),_:1},512),[[B,!c.value]]),C(r(o(j),{"on-update:value":V,style:{width:"40vw",minWidth:"300px",maxWidth:"500px",display:"block"},"show-alpha":!1,swatches:((u=o(f).config.value)==null?void 0:u.colors)?o(f).config.value.colors:X.value},null,8,["swatches"]),[[B,!c.value]]),C(r(o(ne),{value:o(v).width,"onUpdate:value":e[5]||(e[5]=y=>o(v).width=y),step:1,min:1,max:20,style:{width:"40vw",minWidth:"300px",maxWidth:"500px","--rail-height":"10px"}},null,8,["value"]),[[B,!c.value]])]}),_:1})])),c.value?(N(),q(o(m),{key:1,circle:"",style:{position:"absolute",width:"32px",height:"32px",right:"10px",bottom:"10px"},onClick:e[6]||(e[6]=u=>c.value=!c.value)},{icon:d(()=>[r(o(le),null,{default:d(()=>[_e]),_:1})]),_:1})):U("",!0),r(o(se),{show:o(g).show,"onUpdate:show":e[9]||(e[9]=u=>o(g).show=u),style:{position:"fixed",top:"10px"}},{default:d(()=>[r(o(ae),{style:{width:"100vw"},title:"\u8BBE\u7F6E",bordered:!1,size:"huge"},{footer:d(()=>[r(o(J),null,{default:d(()=>[r(o(m),{onClick:G},{default:d(()=>[be]),_:1}),r(o(m),{onClick:Q},{default:d(()=>[Ee]),_:1}),r(o(m),{onClick:e[7]||(e[7]=u=>o(g).show=!1)},{default:d(()=>[Ae]),_:1}),r(o(m),{onClick:e[8]||(e[8]=u=>o(g).ok())},{default:d(()=>[Ce]),_:1})]),_:1})]),default:d(()=>[ye,r(o(j),{"show-alpha":!1,"on-update:value":o(g).changeColor,"default-value":o(v).background},null,8,["on-update:value","default-value"]),xe,r(o(ue),{placeholder:"\u4EE3\u7801\u5757\u8D85\u94FE\u63A5\u6216block id","on-update:value":o(f).set_config_url,value:o(f).my_config_url.value},null,8,["on-update:value","value"])]),_:1})]),_:1},8,["show"])],64))}});const Fe=$({setup(_){return(l,f)=>(N(),q(o(ce),null,{default:d(()=>[r(Be)]),_:1}))}});de(Fe).mount("#app");
//# sourceMappingURL=index.c0daef12.js.map
