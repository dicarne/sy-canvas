import{c as F,r as g,o as T,a as y,d as M,b as N,l as j,u as V,e as P,f as X,g as O,h as a,i as r,w as d,N as _,j as w,t as Y,k as C,v as B,m as W,n as K,p as I,q as Q,s as G,x as Z,F as ee,y as te,z as oe,A as ne,B as ae}from"./vendor.1db7bccd.js";const ue=function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function v(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=v(n);fetch(n.href,i)}};ue();function le(m){var u=atob(m),v=decodeURI(u);return v}const se=()=>{const m=F(),u=g("");T(async()=>{var f;u.value=((f=await y.getBlockAttr(m,"custom-config"))==null?void 0:f.value)||"";const l=window.localStorage.getItem("sy-canvas-config");l!=null&&l!=u.value&&(u.value=l,await y.setBlockAttrs({id:m,attrs:{"custom-config":u.value}})),i()});const v=l=>{u.value=l},t=()=>{window.localStorage.setItem("sy-canvas-config",u.value),y.setBlockAttrs({id:m,attrs:{"custom-config":u.value}}),i()},n=g(null),i=async()=>{try{let l=u.value;u.value.startsWith("siyuan://blocks/")&&(l=l.substring(16));const f=await y.sqlQuery(`select * from blocks where id="${l}"`);f.data.length>0&&(n.value=JSON.parse(f.data[0].content))}catch{console.error("sy-canvas config parse error")}};return{my_config_url:u,set_config_url:v,comfirm_change:t,config:n}},ie=["width","height"],re={style:{position:"fixed",bottom:"0px",width:"100vw",backgroundColor:"#fff",paddingTop:"10px",paddingLeft:"5px",paddingBottom:"10px","box-shadow":"0px 0px 10px #ddd"}},ce=w("\u8BBE\u7F6E"),de=w("\u64A4\u9500"),ve=w(" \u80CC\u666F\u989C\u8272 "),fe=w("\u914D\u7F6E\u4EE3\u7801 "),he=w("\u5E2E\u52A9"),pe=w("\u6E05\u7A7A"),ge=w("\u53D6\u6D88"),we=w("\u786E\u8BA4"),me=M({setup(m){const u=g(null),v=se(),t=g(),n=N({w:1e3,h:1e3}),i=g(!1),l=g([]),f=g({width:2,color:"#000000",points:[]}),c=N({color:"#000",width:3,background:"#fff"}),h=g(!0),x=j.exports.throttle(()=>{!t.value||(t.value.fillStyle=c.background,t.value.fillRect(0,0,n.w,n.h),l.value.forEach(o=>{if(!(!t.value||o.points.length<=1)){t.value.beginPath(),t.value.strokeStyle=o.color,t.value.lineJoin="round",t.value.lineWidth=o.width,t.value.moveTo(o.points[0].x,o.points[0].y);for(let e=1;e<o.points.length;e++){const s=o.points[e];t.value.lineTo(s.x,s.y)}t.value.stroke(),t.value.closePath()}}))},500);T(async()=>{const o=F();if(u.value){if(t.value=u.value.getContext("2d"),!t.value)return;t.value.imageSmoothingEnabled=!0,n.w=u.value.clientWidth,n.h=u.value.clientHeight;const e=await y.getBlockAttr(o,"custom-data");if(e){const s=JSON.parse(le(e.value));l.value=s.stokes,c.background=s.config.background,c.color=s.config.color,c.width=s.config.width}else h.value=!1;setTimeout(x,1)}window.onresize=()=>{n.w=u.value.clientWidth,n.h=u.value.clientHeight,t.value=u.value.getContext("2d"),setTimeout(x,1)}});const $=()=>u.value?{w:u.value.clientWidth,h:u.value.clientHeight}:null,A=o=>{const e=$();if(o instanceof TouchEvent){const s=o.changedTouches[0];return{x:Math.trunc(s.clientX/e.w*n.w),y:Math.trunc(s.clientY/e.h*n.h)}}else if(o instanceof MouseEvent)return{x:Math.trunc(o.clientX/e.w*n.w),y:Math.trunc(o.clientY/e.h*n.h)};throw new Error("unknown device!")},S=o=>{if(h.value)return;const e=A(o);i.value=!0,!!t.value&&(t.value.beginPath(),f.value={width:c.width,color:c.color,points:[e]},t.value.moveTo(e.x,e.y),t.value.strokeStyle=f.value.color,t.value.lineJoin="round",t.value.lineWidth=f.value.width)},L=o=>{!t.value||(f.value.points.push(o),t.value.lineTo(o.x,o.y),t.value.stroke())},D=o=>{if(i.value&&!h.value){const e=A(o);o.preventDefault(),o.stopPropagation(),L(e)}},b=()=>{v.comfirm_change(),y.setBlockAttrs({id:F(),attrs:{"custom-data":btoa(encodeURI(JSON.stringify({version:1,stokes:te(l.value),config:c})))}})},E=o=>{if(i.value&&!h.value){if(i.value=!1,!t.value)return;const e=A(o);t.value.lineTo(e.x,e.y),t.value.stroke(),t.value.closePath(),l.value.push(f.value),f.value=null,b()}},J=o=>{c.color=o},U=g(["#FFFFFF","#000","#18A058","#2080F0","#F0A020","rgba(208, 48, 80, 1)"]),p=N({show:!1,background:"#fff",changeColor:o=>{p.background=o},ok:()=>{c.background=p.background,p.show=!1,b(),setTimeout(x,1)}}),q=()=>{l.value.splice(l.value.length-1,1),x(),b()},z=V(),H=()=>{z.warning({title:"\u8B66\u544A",content:"\u662F\u5426\u6E05\u7A7A\u6240\u6709\u5185\u5BB9\uFF1F\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\uFF01",positiveText:"\u786E\u5B9A",negativeText:"\u4E0D\u786E\u5B9A",onPositiveClick:()=>{l.value=[],c.background="#fff",x(),b(),p.show=!1},onNegativeClick:()=>{}})},R=()=>{window.open("https://github.com/dicarne/sy-canvas#\u8BBE\u7F6E")};return(o,e)=>(P(),X(ee,null,[O("canvas",{style:{width:"100vw",height:"100vh"},width:a(n).w,height:a(n).h,ref:(s,k)=>{k.canvas=s,u.value=s},ontouchstart:S,ontouchmove:D,ontouchend:E,ontouchcancel:E,onpointerdown:S,onpointermove:D,onpointerleave:E,onpointerup:E},null,8,ie),O("div",re,[r(a(I),{align:"center",justify:"center"},{default:d(()=>{var s;return[r(a(_),{onClick:e[0]||(e[0]=k=>h.value=!h.value)},{default:d(()=>[w(Y(h.value?"\u89E3\u9501":"\u9501\u5B9A"),1)]),_:1}),C(r(a(_),{onClick:e[1]||(e[1]=k=>a(p).show=!0)},{default:d(()=>[ce]),_:1},512),[[B,!h.value]]),C(r(a(_),{onClick:e[2]||(e[2]=k=>q()),disabled:l.value.length===0},{default:d(()=>[de]),_:1},8,["disabled"]),[[B,!h.value]]),C(r(a(W),{"on-update:value":J,style:{width:"40vw",minWidth:"300px",maxWidth:"500px",display:"block"},"show-alpha":!1,swatches:((s=a(v).config.value)==null?void 0:s.colors)?a(v).config.value.colors:U.value},null,8,["swatches"]),[[B,!h.value]]),C(r(a(K),{value:a(c).width,"onUpdate:value":e[3]||(e[3]=k=>a(c).width=k),step:1,min:1,max:20,style:{width:"40vw",minWidth:"300px",maxWidth:"500px","--rail-height":"10px"}},null,8,["value"]),[[B,!h.value]])]}),_:1})]),r(a(Z),{show:a(p).show,"onUpdate:show":e[6]||(e[6]=s=>a(p).show=s),style:{position:"fixed",top:"10px"}},{default:d(()=>[r(a(Q),{style:{width:"100vw"},title:"\u8BBE\u7F6E",bordered:!1,size:"huge"},{footer:d(()=>[r(a(I),null,{default:d(()=>[r(a(_),{onClick:R},{default:d(()=>[he]),_:1}),r(a(_),{onClick:H},{default:d(()=>[pe]),_:1}),r(a(_),{onClick:e[4]||(e[4]=s=>a(p).show=!1)},{default:d(()=>[ge]),_:1}),r(a(_),{onClick:e[5]||(e[5]=s=>a(p).ok())},{default:d(()=>[we]),_:1})]),_:1})]),default:d(()=>[ve,r(a(W),{"show-alpha":!1,"on-update:value":a(p).changeColor,"default-value":a(c).background},null,8,["on-update:value","default-value"]),fe,r(a(G),{placeholder:"\u4EE3\u7801\u5757\u8D85\u94FE\u63A5\u6216block id","on-update:value":a(v).set_config_url,value:a(v).my_config_url.value},null,8,["on-update:value","value"])]),_:1})]),_:1},8,["show"])],64))}});const _e=M({setup(m){return(u,v)=>(P(),oe(a(ne),null,{default:d(()=>[r(me)]),_:1}))}});ae(_e).mount("#app");
//# sourceMappingURL=index.f78009b4.js.map
